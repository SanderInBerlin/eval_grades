---
title: "SanderBeerepoot"
format: html
---

link to github: https://github.com/SanderInBerlin/eval_grades.git

```{r}
library(here)
library(vroom)
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(lubridate)
```

```{r}
here::i_am("eval_grades.Rproj")
```

```{r}
courses <- vroom(here("courses.csv"))
```

Question 2
Display the content of the file in a nicely formatted table in your document. Courses should be
sorted in alphabetical order and column names should be written in English. This has to be
done in R for instance using knitr::kable().

```{r}
formatted_courses <-
courses |>
  rename(Course_name = course,
         identifier = course_id,
         module = module,
         `number of exams` = nb_grades)|>
  arrange(Course_name)
knitr::kable(formatted_courses)
```
```{r}
students <- 
  vroom(here("students.csv"))
```
to have group loaded as a factor and id as an integer.
Question 3
Load the student data set. Make sure the birth dates are correctly identified as Date objects by
including the class of the corresponding column in the rendered text. For instance, include a
sentence of the following form:
The birth_date column of the students data frame is of class Date.
Make also sure that the sex is identified as a factor.
```{r}
students_typed <- students |>
  mutate(
    birth_date = as.Date(birth_date, format = "%Y-%m-%d"),
    group = as.factor(group),
    sex = as.factor(sex),
    id = as.integer(id)
  )
```

```{r}
grades <- vroom(here("grades.csv"))
cols(
  id = col_double(),
  course_id = col_double(),
  grade = col_double())
```
Question 4

```{r}
ok_grades <- read_delim(here("grades.csv"),
  delim = "|"
)
cols(
  id = col_double(),
  course_id = col_double(),
  grade = col_double())
```
Question 5: Use a graphical representation to display the number of students per group.
```{r}
students_typed |>
  group_by(group)|>
  summarise(n = n())|>
  ggplot(aes(x = n)) +
  geom_bar()
```
 Question 6: Show the gender balance in each group on a single graphical representation.
```{r}
students_typed|>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill")
```

Question 7
Show graphically the distribution of the age of the students.

```{r}
students_age <- students|>
  mutate(age_years = as.numeric(Sys.Date() - birth_date) / 365.25)
students_age |>
ggplot(aes(x = age_years)) +
  geom_density()
  

```
Question 8
Compute the median age of the students in each group and include in your rendering a table
giving the median age for each group. The median should be reported as an integer.

```{r}
students_age |>
  group_by(group)|>
  summarise(median = median(age_years))
```
Question 9: Build a table with the id, sex and age of the oldest student in each group. Sort the table by
decreasing age order and include it in the rendering.
```{r}

val_per_oldest <- students_age |>
  group_by(group)|>
  slice_max(age_years, n = 1, with_ties = TRUE) |>
  ungroup() |>
  
  select(id, sex, group, Age_Years = age_years) |>
  arrange(desc(Age_Years))
val_per_oldest|>
  knitr::kable()
```
3 Simple grade analysis

Question 10

Give the number of grades in the data set directly in the text of your quarto file, in a sentence
of the form “The data set contains xxx grades.” where xxx is replaced by the number of grades.
This must be computed from the data set. Note that missing grades should obviously not be
included in the total.

```{r}
number_of_grades <- grades |>
  filter(!is.na(grade)) |>
  summarise(
    n = n()
  ) |>
  pull(n)

"The dataset contains `{n} number_of_grades` grades"
```
The value is shown in the values part of the global environment

Question 11

Question 11
Compute the average of all the grades in Neurotechnology and Mind Control in each group and
display graphically this average as a function of the group. It is recommend to use geom_col()
for this task (read the documentation!).

```{r}
course_id_neurotech <- courses |>
  filter(course == "Neurotechnology and Mind Control") |>
  pull(course_id)

avg_grades_by_group <- grades |>
  filter(course_id == course_id_neurotech) |>
  left_join(students, by = "id") |>
  group_by(group)|>
  summarise(
    avg_grade = mean(grade, na.rm = TRUE))

avg_grades_by_group|>
  ggplot(aes(y = avg_grade, x = group)) +
  geom_col()
```

Question 12
Compare graphically the distribution of the grades of the 2 modules.


